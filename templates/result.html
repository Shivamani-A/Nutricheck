{#<!DOCTYPE html>#}
{#<html lang="en">#}
{#{% load static %}#}
{#<head>#}
{#    <title>Nutricheck - Processed Data Results</title>#}
{#    <meta charset="utf-8">#}
{#    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">#}
{##}
{#    <link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700,800&display=swap" rel="stylesheet">#}
{#    <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i&display=swap" rel="stylesheet">#}
{#    <link rel="stylesheet" href="{% static 'css/style.css' %}">#}
{#    <style>#}
{#        .table-responsive {#}
{#            max-height: 400px;#}
{#            overflow-y: auto;#}
{#            overflow-x: auto;#}
{#            border: 1px solid #ddd;#}
{#            border-radius: 8px;#}
{#            padding: 15px;#}
{#        }#}
{#        /* Add styling for canvas to ensure itâ€™s visible */#}
{#        canvas {#}
{#            background-color: #f9f9f9;#}
{#            display: block;#}
{#            width: 100% !important;#}
{#            height: 400px !important;#}
{#        }#}
{#    </style>#}
{#</head>#}
{##}
{#<body class="goto-here">#}
{#    <div class="container">#}
{#        <h1 class="text-center text-primary mb-4">Processed Data Results</h1>#}
{##}
{#        <!-- Filter Form -->#}
{#        <form id="filterForm" method="GET" class="mb-4">#}
{#            <div class="row">#}
{#                <div class="col-md-6 mb-3">#}
{#                    <label for="pdcaas_label" class="font-weight-bold">Filter by PDCAAS Label:</label>#}
{#                    <select name="pdcaas_label" id="pdcaas_label" class="form-control">#}
{#                        <option value="All" {% if pdcaas_label_filter == 'All' %}selected{% endif %}>All</option>#}
{#                        <option value="Excellent Source" {% if pdcaas_label_filter == 'Excellent Source' %}selected{% endif %}>Excellent Source</option>#}
{#                        <option value="Good Source" {% if pdcaas_label_filter == 'Good Source' %}selected{% endif %}>Good Source</option>#}
{#                        <option value="No Claim" {% if pdcaas_label_filter == 'No Claim' %}selected{% endif %}>No Claim</option>#}
{#                    </select>#}
{#                </div>#}
{#                <div class="col-md-6 mb-3">#}
{#                    <label for="ivpdcaas_label" class="font-weight-bold">Filter by IVPDCAAS Label:</label>#}
{#                    <select name="ivpdcaas_label" id="ivpdcaas_label" class="form-control">#}
{#                        <option value="All" {% if ivpdcaas_label_filter == 'All' %}selected{% endif %}>All</option>#}
{#                        <option value="Excellent Source" {% if ivpdcaas_label_filter == 'Excellent Source' %}selected{% endif %}>Excellent Source</option>#}
{#                        <option value="Good Source" {% if ivpdcaas_label_filter == 'Good Source' %}selected{% endif %}>Good Source</option>#}
{#                        <option value="No Claim" {% if ivpdcaas_label_filter == 'No Claim' %}selected{% endif %}>No Claim</option>#}
{#                    </select>#}
{#                </div>#}
{#            </div>#}
{#        </form>#}
{##}
{#        <!-- Display the table -->#}
{#        <div class="table-responsive mt-3">#}
{#            <div id="tableContainer" class="table-sm">#}
{#                {{ table|safe }}#}
{#            </div>#}
{#        </div>#}
{##}
{#        <!-- Download buttons -->#}
{#        <div class="mt-4 text-center">#}
{#            <a href="{% url 'download_csv' %}" class="btn btn-primary">Download CSV</a>#}
{#            <a href="{% url 'download_pdf' %}" class="btn btn-danger">Download PDF</a>#}
{#        </div>#}
{##}
{#        <!-- Chart Section -->#}
{#        <div class="mt-5">#}
{#            <h3 class="text-center">Data Visualization</h3>#}
{#            <div class="row">#}
{#                <div class="col-md-6">#}
{#                    <canvas id="pdcaasChart"></canvas>#}
{#                </div>#}
{#                <div class="col-md-6">#}
{#                    <canvas id="ivpdcaasChart"></canvas>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>#}
{#<script>#}
{#    $(document).ready(function () {#}
{#        try {#}
{#            // Parse the pdcaas_data and ivpdcaas_data from Django template context#}
{#            const pdcaasData = {{ pdcaas_data|safe }};#}
{#            const ivpdcaasData = {{ ivpdcaas_data|safe }};#}
{##}
{#            // Log data to the console for debugging purposes#}
{#            console.log("PDCAAS Data:", pdcaasData);#}
{#            console.log("IVPDCAAS Data:", ivpdcaasData);#}
{##}
{#            if (!pdcaasData || !ivpdcaasData) {#}
{#                console.error("Data is missing for charts.");#}
{#                return;#}
{#            }#}
{##}
{#            // Extract labels and counts for PDCAAS#}
{#            const pdcaasLabels = pdcaasData.map(item => item.label);#}
{#            const pdcaasCounts = pdcaasData.map(item => item.count);#}
{##}
{#            // Extract labels and counts for IVPDCAAS#}
{#            const ivpdcaasLabels = ivpdcaasData.map(item => item.label);#}
{#            const ivpdcaasCounts = ivpdcaasData.map(item => item.count);#}
{##}
{#            // Log the labels and counts for further debugging#}
{#            console.log("PDCAAS Labels:", pdcaasLabels);#}
{#            console.log("PDCAAS Counts:", pdcaasCounts);#}
{#            console.log("IVPDCAAS Labels:", ivpdcaasLabels);#}
{#            console.log("IVPDCAAS Counts:", ivpdcaasCounts);#}
{##}
{#            // Check if data is empty or zero#}
{#            if (pdcaasCounts.every(count => count === 0) && ivpdcaasCounts.every(count => count === 0)) {#}
{#                console.warn("Both PDCAAS and IVPDCAAS data are empty.");#}
{#            }#}
{##}
{#            // Initialize the PDCAAS Chart#}
{#            const pdcaasChartCtx = document.getElementById('pdcaasChart').getContext('2d');#}
{#            new Chart(pdcaasChartCtx, {#}
{#                type: 'bar',#}
{#                data: {#}
{#                    labels: pdcaasLabels.length ? pdcaasLabels : ['Default A', 'Default B'], // Fallback labels#}
{#                    datasets: [{#}
{#                        label: 'PDCAAS Distribution',#}
{#                        data: pdcaasCounts.length ? pdcaasCounts : [10, 20], // Fallback data#}
{#                        backgroundColor: 'rgba(75, 192, 192, 0.2)',#}
{#                        borderColor: 'rgba(75, 192, 192, 1)',#}
{#                        borderWidth: 1#}
{#                    }]#}
{#                },#}
{#                options: {#}
{#                    responsive: true,#}
{#                    scales: {#}
{#                        y: {#}
{#                            beginAtZero: true#}
{#                        }#}
{#                    }#}
{#                }#}
{#            });#}
{##}
{#            // Initialize the IVPDCAAS Chart#}
{#            const ivpdcaasChartCtx = document.getElementById('ivpdcaasChart').getContext('2d');#}
{#            new Chart(ivpdcaasChartCtx, {#}
{#                type: 'pie',#}
{#                data: {#}
{#                    labels: ivpdcaasLabels.length ? ivpdcaasLabels : ['Fallback 1', 'Fallback 2'], // Fallback labels#}
{#                    datasets: [{#}
{#                        label: 'IVPDCAAS Distribution',#}
{#                        data: ivpdcaasCounts.length ? ivpdcaasCounts : [30, 40], // Fallback data#}
{#                        backgroundColor: ['rgba(255, 99, 132, 0.2)', 'rgba(54, 162, 235, 0.2)'],#}
{#                        borderColor: ['rgba(255, 99, 132, 1)', 'rgba(54, 162, 235, 1)'],#}
{#                        borderWidth: 1#}
{#                    }]#}
{#                },#}
{#                options: {#}
{#                    responsive: true,#}
{#                    plugins: {#}
{#                        legend: {#}
{#                            position: 'top',#}
{#                        }#}
{#                    }#}
{#                }#}
{#            });#}
{##}
{#        } catch (error) {#}
{#            console.error("Error initializing charts:", error);#}
{#        }#}
{#    });#}
{#</script>#}
{##}
{#</body>#}
{#</html>#}







<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
    <title>Nutricheck - Processed Data Results</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700,800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Amatic+SC:400,700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="{% static 'css/open-iconic-bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/animate.css' %}">
    <link rel="stylesheet" href="{% static 'css/owl.carousel.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/owl.theme.default.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/magnific-popup.css' %}">
    <link rel="stylesheet" href="{% static 'css/aos.css' %}">
    <link rel="stylesheet" href="{% static 'css/ionicons.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap-datepicker.css' %}">
    <link rel="stylesheet" href="{% static 'css/jquery.timepicker.css' %}">
    <link rel="stylesheet" href="{% static 'css/flaticon.css' %}">
    <link rel="stylesheet" href="{% static 'css/icomoon.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <style>
        /* Styling for table responsiveness and compactness */
        .table-responsive {
            max-height: 600px;
            overflow-y: auto;
            overflow-x: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
        }
        .table-sm {
            font-size: 0.9rem;
        }
        .disabled-link {
            pointer-events: none;
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>

<body class="goto-here">
    <div class="py-1 bg-primary">
        <div class="container">
            <div class="row no-gutters d-flex align-items-start align-items-center px-md-0">
                <div class="col-lg-12 d-block">
                    <div class="row d-flex">
                        <div class="col-md pr-4 d-flex topper align-items-center">
                            <span class="text">Group 10</span>
                        </div>
                        <div class="col-md pr-4 d-flex topper align-items-center">
                            <span class="text">Guelph Research Center</span>
                        </div>
                        <div class="col-md-5 pr-4 d-flex topper align-items-center text-lg-right">
                            <span class="text">COMP8967 Internship Project 1</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">
        <div class="container">
            <a class="navbar-brand" href="{% url 'home' %}">Nutricheck</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="oi oi-menu"></span> Menu
            </button>

            <div class="collapse navbar-collapse" id="ftco-nav">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item"><a href="{% url 'home' %}" class="nav-link">Home</a></li>
                    <li class="nav-item"><a href="{% url 'process_excel' %}" class="nav-link">Upload Files</a></li>
                    <li class="nav-item active"><a href="https://www.canada.ca/en/health-canada/services/technical-documents-labelling-requirements/nutrition-labelling-table-reference-amounts-food.html" class="nav-link">Labeling Reference</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <section class="ftco-section">
        <div class="container">
            <h1 class="text-center text-primary mb-4">Processed Data Results</h1>

            <!-- Filter Form -->
            <form id="filterForm" method="GET" class="mb-4">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="pdcaas_label" class="font-weight-bold">Filter by PDCAAS Label:</label>
                        <select name="pdcaas_label" id="pdcaas_label" class="form-control">
                            <option value="All" {% if pdcaas_label_filter == 'All' %}selected{% endif %}>All</option>
                            <option value="Excellent Source" {% if pdcaas_label_filter == 'Excellent Source' %}selected{% endif %}>Excellent Source</option>
                            <option value="Good Source" {% if pdcaas_label_filter == 'Good Source' %}selected{% endif %}>Good Source</option>
                            <option value="No Claim" {% if pdcaas_label_filter == 'No Claim' %}selected{% endif %}>No Claim</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="ivpdcaas_label" class="font-weight-bold">Filter by IVPDCAAS Label:</label>
                        <select name="ivpdcaas_label" id="ivpdcaas_label" class="form-control">
                            <option value="All" {% if ivpdcaas_label_filter == 'All' %}selected{% endif %}>All</option>
                            <option value="Excellent Source" {% if ivpdcaas_label_filter == 'Excellent Source' %}selected{% endif %}>Excellent Source</option>
                            <option value="Good Source" {% if ivpdcaas_label_filter == 'Good Source' %}selected{% endif %}>Good Source</option>
                            <option value="No Claim" {% if ivpdcaas_label_filter == 'No Claim' %}selected{% endif %}>No Claim</option>
                        </select>
                    </div>
                </div>
            </form>

            <!-- Display the table -->
            <div class="table-responsive mt-3">
                <div id="tableContainer" class="table-sm">
                    {{ table|safe }}
                </div>
            </div>

            <!-- Download buttons -->
            <div class="mt-4 text-center">
                <a href="{% url 'download_csv' %}" class="btn btn-primary">Download CSV</a>
                <a href="{% url 'download_pdf' %}" class="btn btn-danger">Download PDF</a>
            </div>
        </div>
    </section>

    <footer class="ftco-footer ftco-section">
        <div class="col-md-12 text-center">
            <p>
                Copyright &copy;
                <script>document.write(new Date().getFullYear());</script> All rights reserved </a>
            </p>
        </div>
    </footer>

    <!-- JavaScript for AJAX filtering -->
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <script src="{% static 'js/jquery-migrate-3.0.1.min.js' %}"></script>
    <script src="{% static 'js/popper.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/jquery.easing.1.3.js' %}"></script>
    <script src="{% static 'js/jquery.waypoints.min.js' %}"></script>
    <script src="{% static 'js/jquery.stellar.min.js' %}"></script>
    <script src="{% static 'js/owl.carousel.min.js' %}"></script>
    <script src="{% static 'js/jquery.magnific-popup.min.js' %}"></script>
    <script src="{% static 'js/aos.js' %}"></script>
    <script src="{% static 'js/jquery.animateNumber.min.js' %}"></script>
    <script src="{% static 'js/bootstrap-datepicker.js' %}"></script>
    <script src="{% static 'js/scrollax.min.js' %}"></script>
    <script src="{% static 'js/main.js' %}"></script>

    <script>
        $(document).ready(function () {
            $('#pdcaas_label, #ivpdcaas_label').change(function () {
                $.ajax({
                    url: '{% url "process_excel" %}',
                    type: 'GET',
                    data: $('#filterForm').serialize(),
                    success: function (response) {
                        if (response.is_empty) {
                            $('#tableContainer').html('<div class="alert alert-warning text-center">No results found for the filters applied.</div>');
                            $('a.btn').addClass('disabled-link');
                        } else {
                            $('#tableContainer').html(response.table_html);
                            $('a.btn').removeClass('disabled-link');
                        }
                    },
                    error: function () {
                        alert('An error occurred while filtering data.');
                    }
                });
            });
        });
    </script>
</body>
</html>



{#<!DOCTYPE html>#}
{#<html>#}
{#<head>#}
{#    <title>Processed Data Results</title>#}
{#    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">#}
{#    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>\#}
{#    <style>#}
{#        /* CSS to style disabled download buttons */#}
{#        .disabled-link {#}
{#            pointer-events: none;#}
{#            opacity: 0.5;#}
{#            cursor: not-allowed;#}
{#        }#}
{#    </style>#}
{#</head>#}
{#<body>#}
{#    <div class="container">#}
{#        <h1>Processed Data Results</h1>#}
{##}
{#        <!-- Filter Form -->#}
{#        <form id="filterForm" method="GET">#}
{#            <div class="row">#}
{#                <div class="col-md-4">#}
{#                    <label for="pdcaas_label">Filter by PDCAAS Label:</label>#}
{#                    <select name="pdcaas_label" id="pdcaas_label" class="form-control">#}
{#                        <option value="All" {% if pdcaas_label_filter == 'All' %}selected{% endif %}>All</option>#}
{#                        <option value="Excellent Source" {% if pdcaas_label_filter == 'Excellent Source' %}selected{% endif %}>Excellent Source</option>#}
{#                        <option value="Good Source" {% if pdcaas_label_filter == 'Good Source' %}selected{% endif %}>Good Source</option>#}
{#                        <option value="No Claim" {% if pdcaas_label_filter == 'No Claim' %}selected{% endif %}>No Claim</option>#}
{#                    </select>#}
{#                </div>#}
{#                <div class="col-md-4">#}
{#                    <label for="ivpdcaas_label">Filter by IVPDCAAS Label:</label>#}
{#                    <select name="ivpdcaas_label" id="ivpdcaas_label" class="form-control">#}
{#                        <option value="All" {% if ivpdcaas_label_filter == 'All' %}selected{% endif %}>All</option>#}
{#                        <option value="Excellent Source" {% if ivpdcaas_label_filter == 'Excellent Source' %}selected{% endif %}>Excellent Source</option>#}
{#                        <option value="Good Source" {% if ivpdcaas_label_filter == 'Good Source' %}selected{% endif %}>Good Source</option>#}
{#                        <option value="No Claim" {% if ivpdcaas_label_filter == 'No Claim' %}selected{% endif %}>No Claim</option>#}
{#                    </select>#}
{#                </div>#}
{#            </div>#}
{#        </form>#}
{##}
{#        <!-- Display the table -->#}
{#        <div class="mt-3" id="tableContainer">#}
{#            {{ table|safe }}#}
{#        </div>#}
{##}
{#        <!-- Download buttons -->#}
{#        <div class="mt-3">#}
{#            <a href="{% url 'download_csv' %}" class="btn btn-primary">Download CSV</a>#}
{#            <a href="{% url 'download_pdf' %}" class="btn btn-danger">Download PDF</a>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <!-- JavaScript for AJAX filtering -->#}
{#    <script>#}
{#    $(document).ready(function () {#}
{#        // Trigger AJAX when filters change#}
{#        $('#pdcaas_label, #ivpdcaas_label').change(function () {#}
{#            $.ajax({#}
{#                url: '{% url "process_excel" %}',#}
{#                type: 'GET',#}
{#                data: $('#filterForm').serialize(),  // Serialize form data for GET request#}
{#                success: function (response) {#}
{#                    if (response.is_empty) {#}
{#                        // Display "No results found" message and disable download buttons#}
{#                        $('#tableContainer').html('<div class="alert alert-warning">No results found for the filters applied.</div>');#}
{##}
{#                        // Add disabled-link class to disable download links#}
{#                        $('a.btn').addClass('disabled-link');#}
{#                    } else {#}
{#                        // Show the table and enable download buttons#}
{#                        $('#tableContainer').html(response.table_html);#}
{##}
{#                        // Remove disabled-link class to enable download links#}
{#                        $('a.btn').removeClass('disabled-link');#}
{#                    }#}
{#                },#}
{#                error: function () {#}
{#                    alert('An error occurred while filtering data.');#}
{#                }#}
{#            });#}
{#        });#}
{#    });#}
{#</script>#}
{##}
{##}
{#</body>#}
{#</html>#}
